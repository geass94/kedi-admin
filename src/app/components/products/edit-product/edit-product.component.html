<div *ngIf="product != null">
<section class="form-container">
  <form [formGroup]="basicInfoForm" (submit)="onSubmit()">
    <mat-form-field>
      <input matInput placeholder="პროდუქტის სახელი" name="name" formControlName="name" type="text">
    </mat-form-field>

    <mat-form-field>
      <input matInput placeholder="პროდუქტის ფასი" name="price" formControlName="price" type="number">
    </mat-form-field>

    <mat-form-field>
      <input matInput placeholder="პროდუქტის რაოდენობა" name="quantity" formControlName="quantity" type="number">
    </mat-form-field>

    <mat-form-field>
      <input matInput placeholder="ფასდაკლება" name="sale" formControlName="sale" type="number">
    </mat-form-field>

    <mat-form-field>
      <textarea matInput placeholder="პროდუქტის აღწერა" formControlName="description"></textarea>
    </mat-form-field>

    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">
        <!-- This is the tree node template for leaf nodes -->
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
          <li class="mat-tree-node">
            <!-- use a disabled button to provide padding for tree leaf -->
            <button type="button" mat-icon-button disabled></button>
            <mat-checkbox (change)="onCategoryChoose(node)" name="parent" [value]="node" [checked]="inProductCategories(node)">&nbsp;{{node.name}}</mat-checkbox>
          </li>
        </mat-tree-node>
        <!-- This is the tree node template for expandable nodes -->
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
          <li>
            <div class="mat-tree-node">
              <button type="button" mat-icon-button matTreeNodeToggle
                      [attr.aria-label]="'toggle ' + node.name">
                <mat-icon class="mat-icon-rtl-mirror">
                  {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                </mat-icon>
              </button>
              <mat-checkbox (change)="onCategoryChoose(node)" name="parent" [value]="node" [checked]="inProductCategories(node)">&nbsp;{{node.name}}</mat-checkbox>
            </div>
            <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
              <ng-container matTreeNodeOutlet></ng-container>
            </ul>
          </li>
        </mat-nested-tree-node>
      </mat-tree>

    <mat-form-field>
      <mat-select placeholder="აირჩიეთ ფერი" formControlName="color" [compareWith]="compareFn">
        <mat-option>---</mat-option>
        <mat-option *ngFor="let color of colors | async" [value]="color">
          {{color.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field>
      <mat-select placeholder="აირჩიეთ მწარმოებელი" formControlName="manufacturer" [compareWith]="compareFn">
        <mat-option>---</mat-option>
        <mat-option *ngFor="let manufacturer of manufacturers | async" [value]="manufacturer">
          {{manufacturer.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field>
      <mat-select placeholder="აირჩიეთ ზომა" formControlName="size">
        <mat-option>---</mat-option>
        <mat-option value="S">Small</mat-option>
        <mat-option value="M">Medium</mat-option>
        <mat-option value="L">Large</mat-option>
      </mat-select>
    </mat-form-field>
    <div>
      <button mat-button type="submit" color="primary">შენახვა</button>
    </div>
  </form>
</section>
  <p>Edit product variants</p>
<section style="display: flex;">
  <mat-card class="example-card" *ngFor="let variant of variants | async" [ngClass]="{'active': variant.id === product.id}">
    <mat-card-header>
      <div mat-card-avatar class="example-header-image"></div>
      <mat-card-title>{{variant.name}}</mat-card-title>
      <mat-card-subtitle>{{variant.color.name}}</mat-card-subtitle>
    </mat-card-header>
    <img *ngIf="variant.productFiles.length" mat-card-image src="{{variant.productFiles[0].fileUrl}}" alt="{{variant.name}}">
    <mat-card-actions>
      <a mat-button routerLink="/products/{{variant.id}}">Edit</a>
    </mat-card-actions>
  </mat-card>
</section>
  <mat-accordion>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          პროდუქტის სურათები
        </mat-panel-title>
        <mat-panel-description>
          წაშალეთ ან დაამატეთ ახალი სურათები
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-grid-list *ngIf="product.productFiles.length" cols="4" rowHeight="1:1" gutterSize="10px">
        <mat-grid-tile *ngFor="let file of product.productFiles" class="grid-item">
          <img src="{{file.fileUrl}}" alt="{{file.name}}">
          <button title="Delete File" mat-raised-button color="accent" (click)="deleteFile(file)">
            <i class="material-icons">
              remove_circle_outline
            </i>
          </button>
        </mat-grid-tile>
      </mat-grid-list>
      <div *ngIf="product.id">
        <app-file-upload (fileUploaderCallback)="finishUpload(files)" [formDataKey]="'product-id'" [formDataValue]="product.id" [formActionUrl]="'admin/product/add-product-file'"></app-file-upload>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
  <br>
  <div *ngIf="product.bundle != null" class="form-container">
    <p>Buy together at {{product.bundle.price}} with {{product.bundle.sale}}% OFF</p>
    <mat-chip-list>
      <mat-chip color="primary" selected>{{product.name}}</mat-chip>
      <div *ngFor="let b of product.bundle.products">
        &nbsp;+&nbsp;<mat-chip color="accent" selected>{{b.name}}</mat-chip>
      </div>
    </mat-chip-list>
  </div>
  <br>
  <section class="form-container">
    <p>Create Bundle</p>
    <form #f="ngForm" (submit)="createBundle(f)">
      <mat-form-field>
        <input matInput placeholder="Bundle Price" name="price" [ngModel]="price" type="number">
      </mat-form-field>
      <mat-form-field>
        <input matInput placeholder="Bundle Sale" name="sale" [ngModel]="sale" type="number">
      </mat-form-field>
      <mat-form-field>
        <mat-select multiple placeholder="Select products to bundle with" [ngModel]="products" name="products">
          <mat-option *ngFor="let p of productsForBundling" [value]="p" [disabled]="p.id === product.id">{{p.name}}</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button type="submit">Create Bundle</button>
    </form>
  </section>
</div>
