<section class="form-container">
  <label>Add New Parent Category</label>
  <form (submit)="onAdd(f)" #f="ngForm">
    <mat-form-field>
      <input required matInput placeholder="Category Name" name="name" [ngModel]="name" required>
      <mat-error>
        Please enter name
      </mat-error>
    </mat-form-field>
    <button mat-raised-button type="submit" color="primary">Add</button>
  </form>
</section>
<mat-accordion>
  <mat-expansion-panel *ngFor="let category of categories">
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{category.name}}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <ng-template matExpansionPanelContent>
      <mat-tab-group>
        <mat-tab label="Edit Parent Category">
          <br/>
          <form (submit)="onSave(f1)" #f1="ngForm">
            <mat-form-field>
              <input required matInput placeholder="Category Name" name="name" [ngModel]="category.name" value="{{category.name}}">
              <mat-error>
                Please enter name
              </mat-error>
            </mat-form-field>
            <input type="hidden" value="{{category.id}}" [ngModel]="category.id" name="id">
            <button mat-raised-button type="submit" color="primary">Update</button>&nbsp;
            <button mat-raised-button type="button" (click)="onDelete(category)" color="warn">Delete</button>
          </form>
        </mat-tab>
        <mat-tab label="Add Subcateogry">
          <br/>
          <form (submit)="onAdd(f2)" #f2="ngForm">
            <mat-form-field>
              <input required matInput placeholder="Subcategory Name" name="name" [ngModel]="name">
              <mat-error>
                Please enter name
              </mat-error>
            </mat-form-field>
            <p>Choose Parent</p>
            <div class="scrollable">
              <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">
                <!-- This is the tree node template for leaf nodes -->
                <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
                  <li class="mat-tree-node">
                    <!-- use a disabled button to provide padding for tree leaf -->
                    <button type="button" mat-icon-button disabled></button>
                    <mat-radio-button (change)="onParentChoose(node)" name="parent" [value]="node">&nbsp;{{node.name}}</mat-radio-button>
                  </li>
                </mat-tree-node>
                <!-- This is the tree node template for expandable nodes -->
                <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                  <li>
                    <div class="mat-tree-node">
                      <button type="button" mat-icon-button matTreeNodeToggle
                              [attr.aria-label]="'toggle ' + node.name">
                        <mat-icon class="mat-icon-rtl-mirror">
                          {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                        </mat-icon>
                      </button>
                      <mat-radio-button (change)="onParentChoose(node)" name="parent" [value]="node">&nbsp;{{node.name}}</mat-radio-button>
                    </div>
                    <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
                      <ng-container matTreeNodeOutlet></ng-container>
                    </ul>
                  </li>
                </mat-nested-tree-node>
              </mat-tree>
            </div>


            <button mat-raised-button type="submit" color="primary">Add</button>
          </form>
        </mat-tab>
        <mat-tab label="Edit Subcategories" *ngIf="category.children.length > 0">
          <br/>
          <ng-template matTabContent>
            <div class="scrollable">
              <mat-tree [dataSource]="dataSourceChildren" [treeControl]="treeControl" class="example-tree">
                <!-- This is the tree node template for leaf nodes -->
                <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
                  <li class="mat-tree-node">
                    <!-- use a disabled button to provide padding for tree leaf -->
                    <button type="button" mat-icon-button disabled></button>
                    <form class="inline-form" (submit)="onSave(f3)" #f3="ngForm">
                      <mat-form-field>
                        <input required matInput placeholder="Category Name" name="name" [ngModel]="node.name" value="{{node.name}}">
                        <mat-error>
                          Please enter name
                        </mat-error>
                      </mat-form-field>
                      <input type="hidden" value="{{node.id}}" [ngModel]="node.id" name="id">
                      <div class="button-groups">
                        <button type="submit" mat-icon-button color="primary">
                          <mat-icon aria-label="Example icon-button with a heart icon">save</mat-icon>
                        </button>&nbsp;
                        <button mat-icon-button color="warn" type="button" (click)="onDelete(node)">
                          <mat-icon aria-label="Example icon-button with a heart icon">delete</mat-icon>
                        </button>
                      </div>
                    </form>
                  </li>
                </mat-tree-node>
                <!-- This is the tree node template for expandable nodes -->
                <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                  <li>
                    <div class="mat-tree-node">
                      <button type="button" mat-icon-button matTreeNodeToggle
                              [attr.aria-label]="'toggle ' + node.name">
                        <mat-icon class="mat-icon-rtl-mirror">
                          {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                        </mat-icon>
                      </button>
                      <form class="inline-form" (submit)="onSave(f4)" #f4="ngForm">
                        <mat-form-field>
                          <input matInput placeholder="Category Name" name="name" [ngModel]="node.name" value="{{node.name}}">
                          <mat-error>
                            Please enter name
                          </mat-error>
                        </mat-form-field>
                        <input required type="hidden" value="{{node.id}}" [ngModel]="node.id" name="id">
                        <div class="button-groups">
                          <button type="submit" mat-icon-button color="primary">
                            <mat-icon aria-label="Example icon-button with a heart icon">save</mat-icon>
                          </button>&nbsp;
                          <button mat-icon-button color="warn" type="button" (click)="onDelete(node)">
                            <mat-icon aria-label="Example icon-button with a heart icon">delete</mat-icon>
                          </button>
                        </div>
                      </form>
                    </div>
                    <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
                      <ng-container matTreeNodeOutlet></ng-container>
                    </ul>
                  </li>
                </mat-nested-tree-node>
              </mat-tree>
            </div>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </ng-template>
  </mat-expansion-panel>
</mat-accordion>
